AWSTemplateFormatVersion: '2010-09-09'
Transform: 'AWS::Serverless-2016-10-31'
Description: Severless MQ Dashboard generator
Metadata:
  AWS::ServerlessRepo::Application:
    Name: mq-dashboards
    Description: AmazonMQ Dashboards
    Author: Sam Andaluri
    SpdxLicenseId: Apache-2.0
    LicenseUrl: LICENSE.txt
    ReadmeUrl: README.md
    Labels: ['amazon-mq']
    HomePageUrl: https://github.com/sam-andaluri/mqdashboard
    SemanticVersion: 0.2.1
    SourceCodeUrl: https://github.com/sam-andaluri/mqdashboard
Resources:
  MainDashboard:
    Type: 'AWS::Serverless::Function'
    Properties:
      Handler: app.lambda_handler
      Runtime: python3.7
      CodeUri: ./main_dashboard
      Description: 'Main AmazonMQ Dashboard that lists all brokers in a region'
      MemorySize: 128
      Timeout: 60
      Policies:
        - AmazonMQReadOnlyAccess
        - CloudWatchFullAccess
      Events:
        MainInterval:
          Type: Schedule
          Properties:
            Schedule: 'rate(12 hours)'
  BrokerDashboard:
    Type: 'AWS::Serverless::Function'
    Properties:
      Handler: app.lambda_handler
      Runtime: python3.7
      CodeUri: ./broker_dashboard
      Description: 'Dashboard for a given broker and its associated queues and topics'
      MemorySize: 128
      Timeout: 60
      Policies:
        - AmazonMQReadOnlyAccess
        - CloudWatchFullAccess
      Events:
        BrokerInterval:
          Type: Schedule
          Properties:
            Schedule: 'rate(12 hours)'
  ObjectDashboard:
    Type: 'AWS::Serverless::Function'
    Properties:
      Handler: app.lambda_handler
      Runtime: python3.7
      CodeUri: ./object_dashboard
      Description: 'Dashboard for a given queue or topic'
      MemorySize: 128
      Timeout: 60
      Policies:
        - AmazonMQReadOnlyAccess
        - CloudWatchFullAccess
      Events:
        ObjectInterval:
          Type: Schedule
          Properties:
            Schedule: 'rate(12 hours)'
